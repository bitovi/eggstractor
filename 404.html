<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Redirecting...</title>
  </head>
  <body>
    <p>Redirecting to preview...</p>
    <script>
      const arePathsEqual = (pathA, pathB) => {
        const normalize = (path) => path.replace(/^\/+|\/+$/g, '');
        return normalize(pathA) === normalize(pathB);
      };

      const redirect = (pathname) => {
        // Avoid infinite redirect loops
        if (arePathsEqual(pathname, window.location.pathname)) {
          document.body.innerHTML = '<p>Error: 404 Page not found</p>';
          return;
        }

        window.location.href = pathname;
      };

      // Get the path from the URL
      const path = window.location.pathname.split('/').filter(Boolean);
      const repo = path[0];

      if (path.length === 1) {
        // At repo root, redirect to main
        redirect(`/${repo}/main/`);
      } else {
        // Try the branch preview once
        const branchPath = path[1];
        redirect(`/${repo}/${branchPath}/index.html`);
      }
    </script>
  </body>
</html>
